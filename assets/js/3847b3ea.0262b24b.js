"use strict";(self.webpackChunkopenmx=self.webpackChunkopenmx||[]).push([[581],{388:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>d,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var s=l(5893),i=l(1151);const t={title:"Setting up OpenMX",sidebar_label:"Setup",slug:"/",keywords:["openmx","first principles calculation","density functional theory","DFT","bandstructure calculation"]},r=void 0,a={id:"setup",title:"Setting up OpenMX",description:"Please refer to the OpenMX website for detailed",source:"@site/docs/setup.md",sourceDirName:".",slug:"/",permalink:"/openmx/",draft:!1,unlisted:!1,editUrl:"https://github.com/pranabdas/openmx/blob/main/docs/setup.md",tags:[],version:"current",frontMatter:{title:"Setting up OpenMX",sidebar_label:"Setup",slug:"/",keywords:["openmx","first principles calculation","density functional theory","DFT","bandstructure calculation"]},sidebar:"docs",next:{title:"Silicon bandstructure",permalink:"/openmx/silicon"}},o={},c=[{value:"Compile using latest Intel oneAPI libraries",id:"compile-using-latest-intel-oneapi-libraries",level:3}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Please refer to the ",(0,s.jsx)(n.a,{href:"http://www.openmx-square.org",children:"OpenMX website"})," for detailed\ndocumentations. The installation options will depend on your system architecture\nand available libraries. I am installing OpenMX version ",(0,s.jsx)(n.strong,{children:"3.9.9"})," at one of NUS\nHPC clusters."]}),"\n",(0,s.jsx)(n.p,{children:"Get the source code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"wget http://t-ozaki.issp.u-tokyo.ac.jp/openmx3.9.tar.gz\nwget http://www.openmx-square.org/bugfixed/21Oct17/patch3.9.9.tar.gz\ntar -zxvf openmx3.9.tar.gz\nrm openmx3.9.tar.gz\nmv patch3.9.9.tar.gz openmx3.9/source\ncd openmx3.9/source\ntar -zxvf patch3.9.9.tar.gz\nrm patch3.9.9.tar.gz\n"})}),"\n",(0,s.jsx)(n.p,{children:"Load Intel Math Kernel library:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"module load xe_2015\n"})}),"\n",(0,s.jsx)(n.p,{children:"You may check the necessary environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"echo $LD_LIBRARY_PATH\necho $MKLROOT\nenv\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Open the ",(0,s.jsx)(n.code,{children:"makefile"})," and specify ",(0,s.jsx)(n.code,{children:"CC"}),", ",(0,s.jsx)(n.code,{children:"FC"}),", and ",(0,s.jsx)(n.code,{children:"LIB"})," flags according to your\nsystem and libraries. I am using MPI and Intel Math Kernel Libraries."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"CC = mpicc -O3 -qopenmp -I${MKLROOT}/include/fftw -I${MKLROOT}/include\nFC = mpif90 -O3 -qopenmp -I${MKLROOT}/include/fftw\nLIB= -L${MKLROOT}/include/fftw -lfftw3 -L$MKLROOT/lib/intel64 -lmkl_blacs_intelmpi_lp64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_core -lmkl_intel_thread -lpthread -lifcore\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"warning",children:[(0,s.jsxs)(n.p,{children:["Currently I found some issues with the Intel license server while using\n",(0,s.jsx)(n.code,{children:"xe_2015"})," module at NUS HPC clusters. After the module load, you need to export\nfollowing ",(0,s.jsx)(n.code,{children:"ENV"})," variable:"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export "INTEL_LICENSE_FILE=/app1/centos6.3/Intel/xe_2015/composer_xe_2015.3.187/licenses"\n'})})]}),"\n",(0,s.jsxs)(n.p,{children:["If you have ",(0,s.jsx)(n.code,{children:"xe_2018"})," (instead of ",(0,s.jsx)(n.code,{children:"xe_2015"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"module load xe_2018\n"})}),"\n",(0,s.jsx)(n.p,{children:"Use following flags:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"MKLROOT = /opt/intel/mkl\nCC = mpiicc -O3 -xHOST -ip -no-prec-div -qopenmp -I${MKLROOT}/include/fftw -I${MKLROOT}/include\nFC = mpiifort -O3 -xHOST -ip -no-prec-div -qopenmp\nLIB= -L${MKLROOT}/include/fftw -lfftw3 -L$MKLROOT/lib/intel64 -lmkl_blacs_intelmpi_lp64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_core -lmkl_intel_thread -lpthread -lifcore\n"})}),"\n",(0,s.jsx)(n.p,{children:"Once you are set, compile and build the executables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make -j8 all\nmake install\n"})}),"\n",(0,s.jsx)(n.p,{children:"Compile the DosMain program:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make DosMain\n"})}),"\n",(0,s.jsxs)(n.p,{children:["There is ",(0,s.jsx)(n.code,{children:"bandgnu13.c"})," in the source directory, which resulted in error. It\nneeds be compiled using ",(0,s.jsx)(n.code,{children:"gcc"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"module purge\ngcc bandgnu13.c -lm -o bandgnu13\ncp bandgnu13 ../work/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Optionally you may add the ",(0,s.jsx)(n.code,{children:"openmx3.9/work"})," PATH to your ",(0,s.jsx)(n.code,{children:".bashrc"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'export PATH="/home/svu/{username}/openmx3.9/work:$PATH"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"compile-using-latest-intel-oneapi-libraries",children:"Compile using latest Intel oneAPI libraries"}),"\n",(0,s.jsx)(n.p,{children:"Download and install latest Intel oneAPI libraries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://registrationcenter-download.intel.com/akdlm/irc_nas/18673/l_BaseKit_p_2022.2.0.262_offline.sh\n\n# install a subset of components from base toolkit\nsh ./l_BaseKit_p_2022.2.0.262_offline.sh -a --silent --eula accept --components intel.oneapi.lin.dpcpp-cpp-compiler:intel.oneapi.lin.mkl.devel\n\n# download and install hpc toolkit\nwget https://registrationcenter-download.intel.com/akdlm/irc_nas/18679/l_HPCKit_p_2022.2.0.191_offline.sh\nsh ./l_HPCKit_p_2022.2.0.191_offline.sh -a --silent --eula accept\n"})}),"\n",(0,s.jsx)(n.p,{children:"Initialize MKL env:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"source /opt/intel/oneapi/setvars.sh\n"})}),"\n",(0,s.jsxs)(n.p,{children:["OpenMX ",(0,s.jsx)(n.code,{children:"makefile"})," configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"MKLROOT = /opt/intel/oneapi/mkl/2022.1.0\nCC = mpiicc -O3 -xHOST -ip -no-prec-div -qopenmp -I${MKLROOT}/include/fftw -I${MKLROOT}/include\nFC = mpiifort -O3 -xHOST -ip -no-prec-div -qopenmp\nLIB= -L${MKLROOT}/lib/intel64 -lmkl_scalapack_lp64 -lmkl_intel_lp64 -lmkl_intel_thread -lmkl_core -lifcore -lmkl_blacs_intelmpi_lp64 -liomp5 -lpthread -lm -ldl\n"})}),"\n",(0,s.jsx)(n.p,{children:"Compile and install:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make -j4 install\n"})}),"\n",(0,s.jsx)(n.p,{children:"If you like to run tests to verify your installation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"cd openmx3.9/source\nmpirun -np 4 ./openmx -runtest\n"})}),"\n",(0,s.jsxs)(n.p,{children:["You may compare CPU times with ",(0,s.jsx)(n.a,{href:"http://www.openmx-square.org/openmx_man3.9/node17.html",children:"other machines"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Here is a sample PBS job-script for NUS HPC cluster:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",metastring:"showLineNumbers",children:"#!/bin/bash\n#PBS -q parallel12\n#PBS -l select=2:ncpus=12:mpiprocs=12:mem=45GB\n#PBS -j eo\n#PBS -N openmx-test\nsource /etc/profile.d/rec_modules.sh\nmodule load xe_2015\ncd $PBS_O_WORKDIR;\nnp=$( cat  ${PBS_NODEFILE} |wc -l );\nmpirun -np $np -f ${PBS_NODEFILE} openmx input.txt > output.txt\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Input files, Jupyter notebooks, and other source files used in this tutorial can\nbe found in my GitHub repository: ",(0,s.jsx)(n.a,{href:"https://github.com/pranabdas/openmx/",children:"pranabdas/openmx"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Read through the ",(0,s.jsx)(n.a,{href:"http://www.openmx-square.org/openmx_man3.9/",children:"OpenMX manual"}),"\nfor various details."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"http://www.openmx-square.org/viewer/index.html",children:"OpenMX viewer"})," can help you\nchoose certain parameters for the input file e.g., basis configuration. You may\nalso consult this ",(0,s.jsx)(n.a,{href:"http://www.openmx-square.org/openmx_man3.9/node27.html",children:"reference table"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://www.materialscloud.org/work/tools/seekpath",children:"SeeK-path"})," tool can help\nyou build the k-path."]}),"\n",(0,s.jsx)(n.li,{children:"The work directory under OpenMX installation contains lots of example files\nfor your reference."}),"\n"]})})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},1151:(e,n,l)=>{l.d(n,{Z:()=>a,a:()=>r});var s=l(7294);const i={},t=s.createContext(i);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);